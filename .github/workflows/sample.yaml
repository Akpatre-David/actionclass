name: "Sample Workflow"

on:
  push:
    branches:
      - master

jobs:
  testing_job:
    runs-on: ubuntu-latest
    steps:
      - name: "Welcome Step"
        run: |
          echo "Welcome to this step"
          ls -a

      - name: "Checkout from GitHub directory"
        uses: actions/checkout@v4

      - name: "List the project directory"
        run: |
          ls -a

      # Build vulnerable Docker image from Dockerfile.vuln
      - name: "Build Vulnerable Docker Image"
        run: |
          docker build -f Dockerfile.vuln -t 17csc028/actions1:vuln .

      # OPTIONAL: Push to Docker Hub (only if your repo is private or you understand the risk)
      - name: "Push to Docker Hub (optional)"
        if: ${{ secrets.DOCKER_USERNAME && secrets.DOCKER_PASSWORD }}
        run: |
          echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
          docker push 17csc028/actions1:vuln

      # Scan for vulnerabilities (local image)
      - name: "Scan for vulnerabilities"
        uses: snyk/actions/docker@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_SECRET }}
        with:
          image: 17csc028/actions1:vuln
          command: test
          args: --severity-threshold=low

      # Monitor project in Snyk dashboard (always run so dashboard gets snapshot)
      - name: "Monitor project in Snyk"
        if: always()
        uses: snyk/actions/docker@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_SECRET }}
        with:
          image: 17csc028/actions1:vuln
          command: monitor
